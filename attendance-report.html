<!DOCTYPE html>
<html>
<head>
  <title>Attendance Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: Arial;
      padding: 10px;
      background: #f4f6f9;
    }
    h2 { color: #333; }
    select, button {
      padding: 8px;
      margin-bottom: 10px;
    }
    .student-report {
      background: white;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .present { color: green; }
    .absent { color: red; }
  </style>
</head>
<body>
  <button onclick="window.location.href='index.html'">‚Üê Back</button>
  <h2>Attendance Report</h2>

  <label>Select Class:</label>
  <select id="classDropdown" onchange="fetchReport()"></select>

  <div id="reportContainer">Loading...</div>

  <script>
    async function fetchClassList() {
      const res = await fetch('https://script.google.com/macros/s/AKfycbyNWTluHoK_rZD0bJXll7g0vZ3f6yr4bQbrRw5FmIeMDJSQyvO6cTcR6oVZK8e-yj1icA/exec?action=getClassList');
      const classes = await res.json();
      const dropdown = document.getElementById("classDropdown");
      dropdown.innerHTML = classes.map(c => `<option value="${c}">${c}</option>`).join('');
      fetchReport(); // load first class
    }

    async function fetchReport() {
      const className = document.getElementById("classDropdown").value;
      const res = await fetch(`https://script.google.com/macros/s/AKfycbyNWTluHoK_rZD0bJXll7g0vZ3f6yr4bQbrRw5FmIeMDJSQyvO6cTcR6oVZK8e-yj1icA/exec?action=getAttendanceReport&className=${className}`);
      const data = await res.json();
      const container = document.getElementById("reportContainer");

      if (data.error) {
        container.innerHTML = `<p style="color:red;">${data.error}</p>`;
        return;
      }

      let html = '';
      data.report.forEach(stu => {
        html += `<div class="student-report">
          <strong>${stu.roll} - ${stu.name}</strong><br/>
          ${stu.attendance.map(a => `
            <div>${a.date}: 
              <span class="${a.status.toLowerCase()}">${a.status}</span>
            </div>`).join('')}
        </div>`;
      });
      container.innerHTML = html;
    }

    fetchClassList();
  </script>
</body>
</html>
