<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Attendance Report</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: #eaf4fc;
      margin: 0;
    }

    header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    header img {
      height: 50px;
    }

    header h1 {
      font-size: 24px;
      color: #007bff;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    select, input[type="date"], button {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .report {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    th {
      background: #f0f8ff;
      color: #333;
    }

    .summary {
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .back-home {
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      table, th, td {
        font-size: 14px;
      }

      header h1 {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="School Logo" />
    <h1>SDN Bandungrejosari 3 Malang - Attendance Report</h1>
  </header>

  <div class="controls">
    <select id="classSelector"></select>
    <input type="date" id="reportDate" />
    <button onclick="loadAttendanceReport()">Load Report</button>
    <button onclick="exportPDF()">Download PDF</button>
    <button onclick="exportCSV()">Export CSV</button>
  </div>

  <div class="report" id="reportContent">
    <h2>Attendance Details</h2>
    <div id="summary"></div>
    <table id="attendanceTable">
      <thead>
        <tr>
          <th>Roll No</th>
          <th>Name</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="btn-group back-home">
    <button onclick="window.location.href='index.html'">üè† Home</button>
    <button onclick="window.history.back()">üîô Back</button>
  </div>

  <script>
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("reportDate").value = today;

    const classSelector = document.getElementById("classSelector");
    const classes = ["Class_1A", "Class_1B", "Class_2A", "Class_2B"];
    classes.forEach(cls => {
      const option = document.createElement("option");
      option.value = cls;
      option.textContent = cls.replace("_", " ");
      classSelector.appendChild(option);
    });

    function loadAttendanceReport() {
      const className = classSelector.value;
      const date = document.getElementById("reportDate").value;
      if (!className || !date) return alert("Please select class and date.");

      fetch(`https://script.google.com/macros/s/AKfycbyNWTluHoK_rZD0bJXll7g0vZ3f6yr4bQbrRw5FmIeMDJSQyvO6cTcR6oVZK8e-yj1icA/exec?action=getAttendance&className=${className}&date=${date}`)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#attendanceTable tbody");
          tbody.innerHTML = "";
          if (!data || data.length === 0) {
            tbody.innerHTML = `<tr><td colspan='3'>No attendance data found for this date.</td></tr>`;
            document.getElementById("summary").innerText = "";
            return;
          }
          let present = 0, absent = 0;
          data.forEach(s => {
            const row = `<tr>
              <td>${s.roll}</td>
              <td>${s.name}</td>
              <td>${s.status}</td>
            </tr>`;
            tbody.innerHTML += row;
            if (s.status === "Present") present++;
            else absent++;
          });
          document.getElementById("summary").innerText = `Total: ${data.length} | Present: ${present} | Absent: ${absent}`;
        });
    }

    function exportCSV() {
      const table = document.getElementById("attendanceTable");
      let csv = [];
      for (let row of table.rows) {
        let rowData = [];
        for (let cell of row.cells) {
          rowData.push(cell.innerText);
        }
        csv.push(rowData.join(","));
      }
      const csvContent = "data:text/csv;charset=utf-8," + csv.join("\n");
      const a = document.createElement("a");
      a.href = csvContent;
      a.download = "AttendanceReport.csv";
      a.click();
    }

    function exportPDF() {
      const printWindow = window.open("", "", "width=800,height=600");
      const content = document.getElementById("reportContent").innerHTML;
      const css = `<style>
        body { font-family: Arial; padding: 20px; }
        h2 { color: #007bff; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; border: 1px solid #ccc; }
        th { background: #e0f3ff; }
      </style>`;
      printWindow.document.write(`<html><head><title>Attendance PDF</title>${css}</head><body>`);
      printWindow.document.write(`<h2>SDN Bandungrejosari 3 Malang</h2>`);
      printWindow.document.write(`<div>${new Date().toLocaleDateString()}</div>`);
      printWindow.document.write(content);
      printWindow.document.write(`</body></html>`);
      printWindow.document.close();
      printWindow.print();
    }
  </script>
</body>
</html>
