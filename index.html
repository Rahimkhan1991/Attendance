<!DOCTYPE html>
<html>
<head>
  <title>School Attendance</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Select a Class</h2>
  <select id="classSelector">
    <option disabled selected>Loading classes...</option>
  </select>
  <br><br>
  <button onclick="viewStudents()">View Students</button>
  <button onclick="markAttendance()">Mark Attendance</button>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyNWTluHoK_rZD0bJXll7g0vZ3f6yr4bQbrRw5FmIeMDJSQyvO6cTcR6oVZK8e-yj1icA/exec";

    // Load classes from sheet
    fetch(`${WEB_APP_URL}?action=getClassList`)
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById('classSelector');
        select.innerHTML = ''; // clear loading text

        if (data.success) {
          data.classes.forEach(cls => {
            const opt = document.createElement('option');
            opt.value = cls;
            opt.textContent = cls.replace('_', ' ');
            select.appendChild(opt);
          });
        } else {
          alert("Failed to load class list");
        }
        if (action === 'getClassList') {
  return getClassList();
}

      });

    function viewStudents() {
      const className = document.getElementById('classSelector').value;
      localStorage.setItem('selectedClass', className);
      window.location.href = 'view-students.html';
    }
function getClassList() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Class_List");
  const data = sheet.getDataRange().getValues().slice(1); // Skip header
  const classNames = data.map(row => row[0]);

  return ContentService.createTextOutput(JSON.stringify({ success: true, classes: classNames }));
}

    function markAttendance() {
      const className = document.getElementById('classSelector').value;
      localStorage.setItem('selectedClass', className);
      window.location.href = 'mark-attendance.html';
    }
  </script>
</body>
</html>
